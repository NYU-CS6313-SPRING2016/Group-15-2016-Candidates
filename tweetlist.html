<!--
	Author: John Ward
-->
<!--
<html>
	<head>
		<title>2016 Candidates Media Coverage Visualization</title>
		<style>
			body {
				margin: 0px;
				font-family: "Arial"
			}
			#title {
				background-color: black;
				color: white;
				padding: 10px;
			}
			h1 {
				margin: 0;
			}
			.tweetList {
				list-style: none;
				padding: 10px;
				float: left;
			}
			circle {
				opacity: 0.7;
			}
			.domain {
				fill: none;
				stroke: #000;
			}
			.tick {
				font-size: 12;
			}
			.tick line {
				stroke: #ccc;
			}
			#tooltip {
				position: absolute;
				top: 0;
				left: 0;
				background-color: rgba(255,255,255,0.8);
				padding: 5;
				border: solid 1px black;
				visibility: hidden;
				opacity: 0;
				transition: all 0.5s
			}
		</style>
	</head>
	<body>
		<div id="title">
			<h1>Gapminder - Wealth and Health of Nations</h1>
		</div>
		<div>
			<ul class="tweetList" id="tweetList">

			</ul>
			<svg id="viz"></svg>
		</div>
		<!--<input type="range"
				min="1900"
				max="2009"
				value="2008"
				id="yearSelect"
				onchange="setYear(this.value)"
				style="width: 500">-->
<!--		<div id="tooltip">Tooltip</div>
	</body>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script>
		// Parameters
		//var year = 2008;
		var chartWidth = 500;
		var chartHeight = 400;
		var chartMargin = {top: 20, left: 30, right: 20, bottom: 20}
		var chartInnerHeight = chartHeight - chartMargin.top - chartMargin.bottom;
		var chartInnerWidth = chartWidth - chartMargin.left - chartMargin.right;

		// Global Variables
		var data = []
		var list = d3.select("#tweetList");
		var chart = d3.select("#viz");

		var yearLabel =
			chart.append("text")
				.text("Time")
				.style({"font-size": 50, fill: "#ccc"})
				.attr("dx", 50)
				.attr("dy", 70)

		var xAxisGroup = chart.append("g")
			.attr("transform", "translate("
				+ chartMargin.left
				+ ","
				+ (chartInnerHeight + chartMargin.top) + ")");
		var yAxisGroup = chart.append("g").attr("transform", "translate("
			+ chartMargin.left
			+ ","
			+ chartMargin.top + ")");
		var dotGroup = chart.append("g")
			.attr("transform", "translate(" + chartMargin.left + "," + chartMargin.top + ")");

		//Highlight
		function highlight(name) {
			dotGroup.selectAll("circle")
				.style("stroke", function(d, i) {
					return d.screen_name == name ? "black" : undefined
				})
			list.selectAll("li")
				.style("background-color", function(d, i) {
					return d.screen_name == name ? "black" : undefined
				})
				.style("color", function(d, i) {
					return d.screen_name == name ? "white" : undefined
				})
			//d3.select(this).style({stroke: "black"});

		}
		function unhighlight(name) {
			dotGroup.selectAll("circle")
				.style("stroke", undefined)

			list.selectAll("li")
				.style("background-color", undefined)
				.style("color", undefined)
			//d3.select(this).style({stroke: undefined});
		}

		// Set year
		function setYear(newYear) {
			year = newYear;
			yearLabel.text(year);
			render(data);
		}

		// Render section

		function renderList(data) {
			var selection = list.selectAll("li")
				.data(data, function(d) { return d.name});
			selection.enter()
				.append("li")
				.attr("class", "listItem")
				.text(function(d) { return d.name})
				.on("mouseenter", function(d, i) {
					highlight(d.name)
				})
				.on("mouseleave", function(d, i) {
					unhighlight(d.name)
				})
			selection.exit().remove();
		}

		var NETWORKS = ['cnn', 'foxnews', 'msnbc', 'abc', 'bbc']

		function renderChart(data) {
			chart
				.attr("width", chartWidth)
				.attr("height", chartHeight)

			var xScale = d3.scale.linear()
				.range([0, chartInnerWidth])
				.domain([-1000, d3.max(data, function(d) { return d.id})])

			var yScale = d3.scale.linear()
				.range([chartInnerHeight, 0])
				.domain(d3.extent(data, function(d) { return NETWORKS.indexOf(d.screen_name)}))

			var sScale = d3.scale.linear()
				.range([20, 1000])
				.domain(d3.extent(data, function(d) { return d.retweet_count}))

			var cScale = d3.scale.category10();

			var xAxis = d3.svg.axis()
				.tickSize(-360)
				.tickFormat(function(d) {
					var prefix = d3.formatPrefix(d);
					return prefix.scale(d) + prefix.symbol;
				})
				.scale(xScale)
				.orient("bottom")

			var yAxis = d3.svg.axis()
				.scale(yScale)
				.tickSize(-450)
				.orient("left")

			xAxisGroup.call(xAxis);
			yAxisGroup.call(yAxis);

			var selection = dotGroup.selectAll("circle")
				.data(data, function(d) { return d.screen_name});

			selection.enter()
				.append("circle")
					.on("click", function(d, i) {
						alert(d.screen_name);
					})
					.on("mouseenter", function(d, i) {
						//d3.event contains information about event
						//d3.mouse computes mouse position inside one element (relative to upper-left)
						highlight(d.screen_name);
						d3.select("#tooltip").style({
							visibility: "visible",
							top: d3.event.clientY,
							left: d3.event.clientX,
							opacity: 1
						}).text(d.screen_name)
					})
					.on("mouseleave", function(d, i) {
						unhighlight(d.screen_name);
						d3.select("#tooltip").style({
							visibility: "hidden",
							opacity: 0
						})
					})

			selection.exit().remove();

			selection.transition()
				.attr("r", function(d) { return Math.sqrt(sScale(d.retweet_count/Math.PI))})
				.attr("cx", function(d) { return xScale(d.id)})
				.attr("cy", function(d) { return yScale(NETWORKS.indexOf(d.screen_name))})
				.attr("fill", function(d) { return cScale(d.screen_name)})
		}

		function render(data) {
			//console.log(data);
			/*
			var filteredData = data.filter(function(d) {
				return d.screen_name && d.id && NETWORKS.indexOf(d.screen_name);
			});

			filteredData.sort(function(a,b) { return d3.ascending(a.screen_name, b.screen_name)});
			*/
			renderList(data);
			renderChart(data);
		}

		d3.json("data.json", function(error, result){
			data = result;
            render(result);
        })
	</script>
</html>

<html>
	<head>
		<title>Gapiminder - Wealth and Health of Nations</title>
		<style>
			body {
				margin: 0;
			}
			h1 {
				background-color: black;
				color: white;
				padding: 10px;
			}
			.stuff {
				padding:0 10px;
			}
			ul {
				padding: 0;
			}
			ul li {
				list-style: none;
				margin: 0;
			}
		</style>
	</head>
	<body>
		<h1 class="title">Gapiminder - Wealth and Health of Nations</h1>
		<div class="stuff">
			<h2>Tweets</h2>
			<ul id="tweets">
			</ul>
		</div>

		<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
	    <script>
	        //My Code
	        var viz = d3.select("#tweets");
	        var countries = [];

	        d3.json("data.json", function(error, result) {
	            countries = result;
				console.log(result);
	            render();
	        })


	        function render() {
	            var changes = viz.selectAll("div")
	                .data(countries, function(d) { return d.user.screen_name + ": " + d.text });

	            changes.enter()
	                    .append("div")
	                    .text(function(d) {return d.user.screen_name + ": " + d.text});

	            changes.exit().remove();

	            changes.on("click", function(d, i) {
	                countries.splice(i,1);
	                render();
	            });
	        }
	    </script>
	</body>
</html>-->

<html>
	<head>
		<title>2016 Candidates Media Coverage Visualization</title>
		<style>
			body {
				margin: 0;
			}
			h1 {
				background-color: black;
				color: white;
				padding: 10px;
			}
			.stuff {
				float:left;
				padding:0 10px;
			}
			ul {
				padding: 0;
			}
			ul li {
				list-style: none;
				margin: 0;
			}
			circle {
				stroke: black;
			}
		</style>
	</head>
	<body>
		<h1 class="title">2016 Candidates Media Coverage Visualization</h1>
		<svg width="1280" height="400">
			<rect width="1280" height="400" fill="none"></rect>
			<g id="dotGroup">
			</g>
		</svg>
		<div class="stuff">
			<h2>Tweets</h2>
			<ul id="countries">
			</ul>
		</div>
	</body>
	<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script>

		var countries_list = d3.select("#countries");
		var viz, innerWidth, innerHeight;
		var xScale, yScale, colorScale, sizeScale;
		buildViz();

		d3.json("data.json", function(error, result) {
			console.log(result);
			countries = result;
			buildViz(countries);
			render(countries);
		})

		function render(data) {
			render_list(data);
			render_vis(data);
		}


		// ----------------
		// Functions
		// ----------------

		var NETWORKS = ['cnn', 'foxnews', 'msnbc', 'abc', 'bbc']

		function buildViz(data) {

			xScale = d3.scale.linear()
	            .range([0, innerWidth]);
	        //yScale = d3.scale.linear()
	            //.range([innerHeight, 0]);
				//.domain(d3.extent(data, function(d) { return NETWORKS.indexOf(d.user.screen_name); }));

	        colorScale = d3.scale.linear()
			    .domain([-1, 1])
			    .range(["red", "yellow", "green"]);

			sizeScale = d3.scale.linear()
				.domain([0, 1000])
				.range([5, 15])
				.clamp(true);

			viz = d3.select("#dotGroup");
			var width = 1280,
				height = 400,
				margin = { top: 20, left: 20, right: 20, bottom: 20 };
			innerWidth = width - margin.left - margin.right;
			innerHeight = height - margin.top - margin.bottom;
			viz.attr("transform",
					 "translate(" + margin.left + "," + margin.top + ")");
		}

		function render_vis(data) {
			var dataPoints = viz.selectAll("circle").data(data);

			xScale.domain(d3.extent(data, function(d) {return d.id}));
            //yScale.domain(d3.extent(data, function(d) {return NETWORKS.indexOf(d.user.screen_name)}));

			dataPoints.enter()
				.append("circle")
				.attr("r", function(d,i) {
					var s = d.retweet_count;

					s = s != undefined ? sizeScale(s) : 0;
					console.log(s);
					return s;
				})
				.attr("cx", function(d, i) {
					var x = d.id;
					x = x != undefined ? xScale(x) : 0;
					//console.log(x);
					return x;
				})
				.attr("cy", function(d, i) {
					var y = NETWORKS.indexOf(d.user.screen_name.toLowerCase());
					console.log(y);
					y = y != undefined ? y/4*innerHeight : 0;
					console.log(y);
					//console.log(y);
					return y;
				})
				.attr("fill", function(d, i) {
					var c = colorScale(d.sentiment.comparative);
					//console.log(d.region);
					return ( c == undefined ? "" : c )
				})
				.attr("opacity", 0.8)
		}

		function render_list(data) {
			var changes = countries_list.selectAll("div")
				.data(data, function(d) { return d.user.screen_name + ": " + d.text + " (" + d.sentiment.comparative + ")" });

			changes.enter()
					.append("div")
					.text(function(d) { return d.user.screen_name + ": " + d.text + " (" + d.sentiment.comparative + ")" });

			changes.exit().remove();

			changes.on("click", function(d, i) {
				data.splice(i,1);
				render();
			});
		}
	</script>

</html>
